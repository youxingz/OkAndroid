(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[802],{4935:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/device_dashboard",function(){return a(7503)}])},8953:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});var n=a(5893),i=a(7294),l=a(3892),r=a.n(l);function s(e){let[t,a]=(0,i.useState)("断开连接");(0,i.useEffect)(()=>{window&&(window.$pgUpdateBluetoothStatus=e=>{let t="断开连接";switch(e){case"connecting":t="连接中...";break;case"services_discovering":t="服务发现中...";break;case"connected":t="已连接";break;case"disconnected":t="断开连接";break;case"disconnecting":t="正在断开连接..."}a(t)})},[]);let l=()=>{alert("Open Drawer")};return(0,n.jsxs)("div",{className:r().appbar,children:[(0,n.jsxs)("div",{className:r().statusbar,children:[(0,n.jsx)("div",{className:r().device_type_name,children:e.title}),(0,n.jsxs)("div",{className:r().icon_list,children:[(0,n.jsx)("div",{className:r().ble_status,style:"断开连接"==t?{color:"#ea3c3c"}:{},children:t}),(0,n.jsx)("div",{children:"100%"})]})]}),(0,n.jsxs)("div",{className:r().titlebar,children:[(0,n.jsx)("div",{className:r().left,children:e.children}),(0,n.jsx)("div",{className:r().right,children:(0,n.jsx)("div",{className:r().menu,onClick:l,children:(0,n.jsx)("img",{src:"/icon/drawers@3x.png"})})})]})]})}},7503:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ev}});var n=a(5893),i=a(1857),l=a.n(i),r=a(8953),s=a(2806),o=a(8271),c=a(7294),u=a(1517),d=a.n(u);let h=(0,o.ZP)(s.Z)({"& .MuiPaper-root":{background:"none",overflow:"hidden",borderRadius:"12px 12px 0 0",backgroundColor:"white"}});function v(e){let{visible:t=!1}=e;return(0,n.jsx)("div",{children:(0,n.jsx)(h,{allowSwipeInChildren:!0,disableBackdropTransition:!0,anchor:"bottom",open:t,onClose:e.onClose,onOpen:e.onOpen,children:(0,n.jsxs)("div",{children:[e.showDrawerBar&&(0,n.jsx)("div",{className:d().drawer_bar,children:(0,n.jsx)("div",{className:d().bar})}),(0,n.jsx)("div",{className:d().container,children:e.children})]})})})}var _=a(4924);class g{enable(){this.node.ontouchstart=this.start_handler,this.node.ontouchmove=this.move_handler,this.node.ontouchcancel=this.end_handler,this.node.ontouchend=this.end_handler}onTouchStart(e){this.onTouchStartCallback=e}onSingleMove(e){this.onSingleMoveCallback=e}onDoubleZoom(e){this.onDoubleZoomCallback=e}constructor(e){(0,_.Z)(this,"start_handler",e=>{if(e.preventDefault(),2===e.targetTouches.length)for(let t=0;t<e.targetTouches.length;t++)this.tpCache.push(e.targetTouches[t]);else 1===e.targetTouches.length&&(this.singleTpCache=e.targetTouches[0]);this.onTouchStartCallback&&this.onTouchStartCallback(e.targetTouches)}),(0,_.Z)(this,"move_handler",e=>{if(e.preventDefault(),2===e.targetTouches.length&&2===e.changedTouches.length){let t=this.tpCache.findLastIndex(t=>t.identifier===e.targetTouches[0].identifier),a=this.tpCache.findLastIndex(t=>t.identifier===e.targetTouches[1].identifier);if(t>=0&&a>=0){let n=Math.abs(this.tpCache[t].clientX-e.targetTouches[0].clientX),i=Math.abs(this.tpCache[a].clientX-e.targetTouches[1].clientX);this.onDoubleZoomCallback&&this.onDoubleZoomCallback(n,i)}else this.tpCache=[]}else if(1===e.targetTouches.length&&1===e.changedTouches.length&&this.singleTpCache){let t=parseInt(this.singleTpCache.clientX-e.targetTouches[0].clientX);this.onSingleMoveCallback&&this.onSingleMoveCallback(t),this.singleTpCache=e.targetTouches[0]}}),(0,_.Z)(this,"end_handler",e=>{e.preventDefault(),e.targetTouches.length}),this.node=e,this.tpCache=[],this.singleTpCache=null}}class p{addPoint(e){let{x:t,y:a}=e;this.data.push({x:t,y:a})}update(e){let t=[],a=this.data.length,n=0,i=0;for(;n<=a;){let a=this.data[n];if(n++,!a)break;if(a.x<e[0])continue;if(a.x>e[1])break;let l=this.getPhyPointX(a.x);if(i!==l){i=l;let e=this.getPhyPointY(a.y);t.push({x:l,y:e})}}return t}getPhyPointX(e){return this.waveContext.getPhyPointX(e)}getPhyPointY(e){return this.waveContext.getPhyPointY(e)}fastSearchIndex(){return(e=>{let t=0,a=this.data.length;for(let n=0;n<a;){let a=e-this.data[n].x;if(a>=-10&&a<=10){t=n;break}a>0?n+=a:n-=a}return t})(this.rangeX[0])}constructor(e,t=[]){this.data=t,this.waveContext=e,this.canvas=e.canvas}}class x{update(){let{rangeX:e=[],rangeY:t=[]}=this.waveContext,{width:a,height:n}=this.waveContext.canvas,i=Math.round((e[1]-e[0])/10),l=Math.abs(this.getPhyPointX(i)-this.getPhyPointX(0)),r=Math.round((t[1]-t[0])*l/n);this.drawGrid(l),this.drawAxis(l,i,r)}drawGrid(e){let{context:t}=this.waveContext,{width:a,height:n}=this.waveContext.canvas,i=this.getPhyPointX(0),l=this.getPhyPointY(0);i<0&&(i%=e,i+=e),l<0&&(l%=e,l+=e),t.save(),t.beginPath(),t.lineWidth=1,t.strokeStyle="#666",t.setLineDash([6,6]);let r=i,s=l;for(;r<a;)t.moveTo(r,0),t.lineTo(r,n),r+=e;for(r=i;r>0;)t.moveTo(r,0),t.lineTo(r,n),r-=e;for(;s<n;)t.moveTo(0,s),t.lineTo(a,s),s+=e;for(s=l;s>0;)t.moveTo(0,s),t.lineTo(a,s),s-=e;t.stroke()}drawAxis(e,t,a){let{context:n,DPI_RATIO:i,phyOriginX:l,phyOriginY:r}=this.waveContext,{width:s,height:o}=this.waveContext.canvas;n.beginPath();let c=this.getPhyPointX(0),u=this.getPhyPointY(0),d=0;if(c<0){let a=Math.round(c/e);d-=t*(a-1),c%=e,c+=e}if(u<0){let t=Math.round(u/e);d-=a*(t-1),u%=e,u+=e}n.lineWidth=1.6,n.strokeStyle="#eee",n.setLineDash([]),n.moveTo(l,0),n.lineTo(l,o),n.moveTo(0,r),n.lineTo(s,r),n.moveTo(0,u),n.lineTo(s,u),n.stroke(),n.fillStyle="#eee",n.textAlign="center";let h=10*i;n.font=h+"px sans-serif";let v=c,_=u,g=d,p=0;for(;v<s;)n.fillText(g,v,r+h),v+=e,g+=t;for(v=c,g=d;v>0;)n.fillText(g,v,r+h),v-=e,g-=t;for(n.textAlign="right";_<o;)n.fillText(p+" ",l,_),_+=e,p-=a;for(_=u,p=0;_>0;)n.fillText(p+" ",l,_),_-=e,p+=a}getPhyPointX(e){return this.waveContext.getPhyPointX(e)}getPhyPointY(e){return this.waveContext.getPhyPointY(e)}constructor(e){this.waveContext=e}}class m{updateSize(e,t,a,n){this.width=e,this.height=t,this.canvas.width=e*this.DPI_RATIO,this.canvas.height=t*this.DPI_RATIO,this.canvas.style.width=e+"px",this.canvas.style.height=t+"px",this.canvas.style.touchAction="pan-x",this.phyOriginX=a,this.phyOriginY=this.canvas.height-n}updateRange(e,t){this.rangeX=e,this.rangeY=t,this.canvasRatioW=this.canvas.width/(this.rangeX[1]-this.rangeX[0]),this.canvasRatioH=this.canvas.height/(this.rangeY[1]-this.rangeY[0])}updateTransform(e,t){this.scaleX=e,this.scaleY=t}addCurve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=new p(this,t);return this.curves[e]=a,a}removeCurve(e){delete this.canvas[e]}update(){for(let e in this.clear(),this.drawCoordinate(),this.curves)this.drawCurve(this.curves[e].update(this.rangeX))}clear(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}drawCoordinate(){this.coordinate.update()}drawCurve(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e||0===e.length)return;let t=this.context;t.save(),t.lineWidth=1.6,t.strokeStyle="rgb(232, 191, 65)";let a=e[0];for(let n of(t.moveTo(a.x,a.y),t.beginPath(),e))t.lineTo(n.x,n.y);t.stroke(),t.restore()}getPhyPointX(e){return this.phyOriginX+Math.round((e-this.rangeX[0])*this.scaleX*this.canvasRatioW)}getPhyPointY(e){return this.phyOriginY-Math.round((e-this.rangeY[0])*this.scaleY*this.canvasRatioH)}getRealPointX(e){return Math.round((e-this.phyOriginX)/(this.scaleX*this.canvasRatioW)+this.rangeX[0])}getRealPointY(e){return Math.round((this.phyOriginX-e)/(this.scaleY*this.canvasRatioH)+this.rangeY[0])}constructor(e,t,a,n=2){this.canvas=e,this.DPI_RATIO=n,this.coordinate=new x(this),this.context=e.getContext("2d"),this.updateSize(t,a,48,32),this.updateTransform(1,1),this.curves={}}}class f{addCurve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=this.waveContext.addCurve(e,t);return this.update(),a}removeCurve(e){this.waveContext.removeCurve(e)}addPoint(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=this.waveContext.curves[e];if(a){for(let e of t)a.addPoint(e);this.update()}}reset(){this.waveContext.updateRange(this.resetRangeX,this.resetRangeY),this.waveContext.update()}update(e,t){e&&t&&this.waveContext.updateRange(e,t),this.waveContext.update()}initTouchEvent(){if(!this.canvas)return;let e=new g(this.canvas),t=this.waveContext.rangeX||this.resetRangeX,a=null,n=null;e.onTouchStart(e=>{if(t=this.waveContext.rangeX||this.resetRangeX,2===e.length){if(a=e[0],n=e[1],a.clientX>n.clientX){let e=a;a=n,n=e}this.waveContext.getRealPointX(a.clientX),this.waveContext.getRealPointX(n.clientX)}}),e.onSingleMove(e=>{let a=this.waveContext.getRealPointX(0),n=this.waveContext.getRealPointX(e)-a;0!==e&&(t=[t[0]+n,t[1]+n],this.update(t,this.resetRangeY))}),e.enable()}constructor(e,t,a){this.canvas=e,this.width=t,this.height=a,this.DPI_RATIO=window.devicePixelRatio||2,this.waveContext=new m(e,t,a,this.DPI_RATIO),this.initTouchEvent(),this.resetRangeX=[0,1100],this.resetRangeY=[-200,200],this.reset()}}function b(e){let t=(0,c.useRef)(null),a=(0,c.useRef)(null),[i,l]=(0,c.useState)(0),[r,s]=(0,c.useState)(0),[o,u]=(0,c.useState)(null),{points:d=[]}=e;return(0,c.useEffect)(()=>{let e=a.current,t=e.offsetWidth,n=e.offsetHeight;l(t),s(n),console.log({w:t,h:n})},[]),(0,c.useEffect)(()=>{o&&o.addCurve("sample",d)},[d]),(0,c.useEffect)(()=>{if(i<1||r<1)return;let e=new f(t.current,i,r);u(e)},[i,r]),(0,n.jsx)("div",{style:{width:e.width,height:e.height},ref:a,onClick:null,children:(0,n.jsx)("canvas",{width:i,height:r,ref:t})})}(e=>{for(var t=1,a=0,n=[],i=0;i<1e3;i++)n.push({x:t,y:a+=Math.round(5+-10*Math.random())}),t++})(0);var y=a(3321),j=a(5399),C=a.n(j),w=a(2435),k=a(2422);let P=(0,o.ZP)(w.ZP)({color:"rgb(123, 156, 198)",height:8,"& .MuiSlider-track":{border:"none"},"& .MuiSlider-thumb":{height:24,width:24,backgroundColor:"#333",border:"2px solid #FFF","&:focus, &:hover, &.Mui-active, &.Mui-focusVisible":{boxShadow:"inherit"},"&.Mui-active":{borderRadius:4,borderWidth:2,height:28,width:28},"&:before":{display:"none"}},"& .MuiSlider-valueLabel":{backgroundColor:"rgb(123, 156, 198)"}});function T(e){let{title:t="",unit:a="",latex_unit:i,min:l=0,max:r=100,defaultValue:s,decimal:o=!1,onChange:c}=e,u=(e,t)=>{c&&c(t)},d=e=>{c&&c(e.target.value)};return(0,n.jsxs)("div",{className:C().container,children:[(0,n.jsxs)("div",{className:C().label,children:[t,"："]}),(0,n.jsxs)("div",{className:C().slider,children:[(0,n.jsx)(P,{valueLabelDisplay:"auto","aria-label":"pretto slider",size:"small",value:e.current,max:r,min:l,step:o?.01:1,onChange:u,color:"secondary"}),(0,n.jsx)(k.Z,{id:"outlined-number",label:"",type:"number",size:"small",style:{width:140,color:"#333"},InputLabelProps:{shrink:!0},InputProps:{step:10,min:0,max:100,type:"number",inputProps:{inputmode:"decimal"},value:e.current,endAdornment:(0,n.jsx)("div",{children:a}),style:{color:"#333",border:"1px var(--primary-color) solid"}},onChange:d})]})]})}var N=a(2557),S=a.n(N),X=a(1131),D=a(6420);function M(e){let{title:t="",unit:a="",latex_unit:i,defaultValue:l,options:r=[],onChange:s}=e,o=(e,t)=>{s&&s(t)};return(0,n.jsxs)("div",{className:S().container,children:[(0,n.jsxs)("div",{className:S().label,children:[t,"："]}),(0,n.jsx)("div",{className:S().selector,children:(0,n.jsx)(X.Z,{color:"info",value:e.current,exclusive:!0,size:"small",onChange:o,"aria-label":t,style:{border:"1px var(--primary-color) solid"},children:r.map(t=>(0,n.jsx)(D.Z,{value:t.value,style:e.current==t.value?{padding:"4px"}:{color:"#333",padding:"4px"},children:(0,n.jsxs)("span",{style:{padding:"0 12px"},children:[" ",t.label," "]})},t.value))})})]})}var R=a(3477),A=a.n(R);function I(e){let{config:t={},onPointsUpdate:a,onValuesChange:i,onPaneRemove:l,resetPanel:r}=e;(0,c.useEffect)(()=>{o()},[]);let s=(e,t)=>{i&&i(e,t),o()},o=()=>{let e=(t.params||[]).map(e=>e.current),n=t.calculation.gen_func(t,...e);a&&a(n)},u=()=>{(t.params||[]).forEach((e,t)=>{i&&i(t,e.default_value)}),o(),r&&r()};return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:A().topleft_title,children:(0,n.jsx)("span",{children:"波形编辑"})}),(0,n.jsx)("div",{className:A().config_panel,children:(t.params||[]).map((e,a)=>{switch(e.type){case"range::integer":return(0,n.jsx)(T,{title:e.name,unit:e.unit,latex_unit:e.latex_unit,min:e.value[0],max:e.value[1],defaultValue:e.default_value,current:e.current,onChange:e=>s(a,e)},t.title+"-"+e.key);case"range::decimal":return(0,n.jsx)(T,{decimal:!0,title:e.name,unit:e.unit,latex_unit:e.latex_unit,min:e.value[0],max:e.value[1],defaultValue:e.default_value,current:e.current,onChange:e=>s(a,e)},t.title+"-"+e.key);case"option::boolean":return(0,n.jsx)(M,{title:e.name,unit:e.unit,latex_unit:e.latex_unit,options:e.value,defaultValue:e.default_value,current:e.current,onChange:e=>s(a,e)},t.title+"-"+e.key)}})}),(0,n.jsxs)("div",{className:A().bottom_container,children:[(0,n.jsx)(y.Z,{size:"large",variant:"contained",onClick:u,fullWidth:!0,className:A().button,children:"重置"}),(0,n.jsx)(y.Z,{size:"large",variant:"contained",onClick:e.closeEditPanel,fullWidth:!0,className:A().button,color:"error",children:"完成"})]})]})}var Z=a(2795),V=a.n(Z);a(381);var Y=a(1163),E=a(3398),W=a.n(E);function O(e){return(0,n.jsx)("div",{className:W().device_icon,...e,children:(0,n.jsx)("img",{src:e.image})})}let z=e=>(0,n.jsxs)("div",{className:V().card,children:[(0,n.jsxs)("div",{className:V().card_header,children:[(0,n.jsx)("img",{className:V().card_icon,src:e.icon}),(0,n.jsx)("div",{className:V().card_title,children:e.title})]}),(0,n.jsx)("div",{className:V().card_content,children:e.children})]});function B(e){(0,Y.useRouter)();let t=e.waveConfig||{};return(0,n.jsxs)("div",{className:V().container,onClick:null,...e,children:[(0,n.jsx)("div",{className:V().topleft_title,children:(0,n.jsx)("span",{children:t.title})}),(0,n.jsxs)("div",{className:V().left,children:[" ",(0,n.jsx)(O,{image:t.image})]}),(0,n.jsxs)("div",{className:V().right,children:[" ",(t.params||[]).filter(e=>e.preview).map(e=>(console.log(e),(0,n.jsxs)(z,{title:e.name,icon:e.icon,children:[" ",e.current," ",e.unit," "]})))]}),(0,n.jsxs)("div",{className:V().end,children:[" ",(0,n.jsx)("div",{className:V().delete_icon,children:(0,n.jsx)("img",{onClick:e.deleteEditPanel,src:"/icon2/delete.png"})}),(0,n.jsx)("div",{className:V().edit_icon,children:(0,n.jsx)("img",{onClick:e.openEditPanel,src:"/icon2/write.png"})})]})]})}var L=a(2428),q=void 0,U=a(1329),F=a.n(U),H=a(655),G=a(5195),Q=a(657),J=a(1425),K=a(6580),$=a(8951),ee=a(7645);let et=e=>fetch("/local-api/trigger",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)}),ea={exp:{title:"指数递降",params:[{key:"alpha",name:"Alpha",latex:"\\alpha",type:"range::integer",unit:"V",latex_unit:"V",value:[0,100],default_value:80},{key:"beta",name:"Beta",latex:"\\beta",type:"range::decimal",value:[0,10],default_value:3.14},{key:"offset",name:"偏移",latex:"C",type:"range::integer",value:[0,100],default_value:50},{key:"count",name:"个数",latex:"n",type:"range::integer",unit:"个",latex_unit:void 0,value:[0,500],default_value:10},{key:"alternate",name:"是否交错",latex:"",type:"option::boolean",value:[{label:"是",value:!0},{label:"否",value:!1}],default_value:!0},{key:"period",name:"周期",latex:"T",type:"range::integer",unit:"us",latex_unit:"\\mu s",value:[1e3,2e6],default_value:2e4},{key:"duty_ratio",name:"占空比",latex:"Duty",type:"range::integer",unit:"%",latex_unit:void 0,value:[0,50],default_value:40}],calculation:{latex:"Volt=\\alpha\\cdot\\e^{-\\sqrt(\\beta) t / 100}+\\C",gen_func:function(e,t,a,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5?arguments[5]:void 0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,o=Math.round(r/1e3),c=Math.sqrt(a)/100,u=[],d=i*o,h=o*s/100,v=0,_=0,g=0;for(;v++<d;){let e=0;++_<h?(e=t*Math.exp(-v*c)+n,l&&(e*=g%2==0?1:-1)):e=0,_===o&&(_=0,g++),u.push({x:v,y:Math.round(e)})}return u}}},sin:{title:"正弦函数",tag:"sin",image:"/icon2/sin.png",params:[{key:"alpha",name:"A",latex:"A",type:"range::integer",unit:"V",latex_unit:"V",value:[0,100],default_value:80,current:0,preview:!1},{key:"f",name:"频率",latex:"f",type:"range::decimal",value:[0,1],default_value:.2,current:0,preview:!1},{key:"phi",name:"Phi",latex:"\\phi",type:"range::decimal",value:[0,3.14],default_value:1.57,current:0,preview:!1},{key:"offset",name:"偏移",latex:"C",type:"range::decimal",value:[0,100],default_value:0,current:0,preview:!1},{key:"count",name:"个数",latex:"n",type:"range::integer",unit:"个",latex_unit:void 0,value:[0,500],default_value:10,current:0,preview:!1},{key:"alternate",name:"是否交错",latex:"",type:"option::boolean",value:[{label:"是",value:!0},{label:"否",value:!1}],default_value:!0,current:!0,preview:!1},{key:"period",name:"周期",latex:"T",type:"range::integer",unit:"us",latex_unit:"\\mu s",value:[1e3,2e6],default_value:2e4,current:1e3,preview:!1},{key:"duty_ratio",name:"占空比",latex:"Duty",type:"range::integer",unit:"%",latex_unit:void 0,value:[0,50],default_value:40,current:0,preview:!1}],calculation:{latex:"Volt=A\\cdot\\sin({f / 2pi \\cdot t})+\\C",gen_func:function(e,t,a,n,i){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=Math.round(s/1e3),u=a/3.14,d=[],h=l*c,v=c*o/100,_=0,g=0,p=0;for(;_++<h;){let e=0;++g<v?(e=t*Math.sin(u*_+n)+i,r&&(e*=p%2==0?1:-1)):e=0,g===c&&(g=0,p++),d.push({x:_,y:Math.round(e)})}return d}}},constant:{title:"常量",params:[{key:"alpha",name:"A",latex:"A",type:"range::integer",unit:"V",latex_unit:"V",value:[0,100],default_value:80},{key:"direction",name:"正负",latex:"",type:"option::boolean",value:[{label:"正",value:!0},{label:"负",value:!1}],default_value:!0},{key:"count",name:"个数",latex:"n",type:"range::integer",unit:"个",latex_unit:void 0,value:[0,500],default_value:10},{key:"period",name:"周期",latex:"T",type:"range::integer",unit:"us",latex_unit:"\\mu s",value:[1e3,2e6],default_value:2e4}],calculation:{latex:"Volt=C",gen_func:function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=Math.round(i/1e3),r=[],s=n*l,o=0,c=0;for(;o++<s;){let e=a?t:-t;++c===l&&(c=0),r.push({x:o,y:Math.round(e)})}return r}}},cos:{title:"余弦函数",params:[{key:"alpha",name:"A",latex:"A",type:"range::integer",unit:"V",latex_unit:"V",value:[0,100],default_value:80},{key:"f",name:"频率",latex:"f",type:"range::decimal",value:[0,1],default_value:.2},{key:"phi",name:"Phi",latex:"\\phi",type:"range::decimal",value:[0,3.14],default_value:1.57},{key:"offset",name:"偏移",latex:"C",type:"range::decimal",value:[0,100],default_value:0},{key:"count",name:"个数",latex:"n",type:"range::integer",unit:"个",latex_unit:void 0,value:[0,500],default_value:10},{key:"alternate",name:"是否交错",latex:"",type:"option::boolean",value:[{label:"是",value:!0},{label:"否",value:!1}],default_value:!0},{key:"period",name:"周期",latex:"T",type:"range::integer",unit:"us",latex_unit:"\\mu s",value:[1e3,2e6],default_value:2e4},{key:"duty_ratio",name:"占空比",latex:"Duty",type:"range::integer",unit:"%",latex_unit:void 0,value:[0,50],default_value:40}],calculation:{latex:"Volt=A\\cdot\\cos({f / 2pi \\cdot t})+\\C",gen_func:function(e,t,a,n,i){let l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=Math.round(s/1e3),u=a/3.14,d=[],h=l*c,v=c*o/100,_=0,g=0,p=0;for(;_++<h;){let e=0;++g<v?(e=t*Math.cos(u*_+n)+i,r&&(e*=p%2==0?1:-1)):e=0,g===c&&(g=0,p++),d.push({x:_,y:Math.round(e)})}return d}}},pluse:{title:"脉冲",tag:"pulse",params:[{key:"alpha",name:"A",latex:"A",type:"range::integer",unit:"V",latex_unit:"V",value:[0,100],default_value:80,current:0},{key:"period",name:"周期",latex:"T",type:"range::integer",unit:"us",latex_unit:"\\mu s",value:[1e3,2e6],default_value:2e4,current:1e3},{key:"duty_ratio",name:"占空比",latex:"Duty",type:"range::integer",unit:"%",latex_unit:void 0,value:[0,50],default_value:10,current:0}],calculation:{latex:"Volt=A\\delta(t)",gen_func:function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;q.params[0].current=t,q.params[1].current=a,q.params[2].current=n;let i=Math.round(a/1e3),l=[],r=1*i,s=i*n/100,o=0,c=0;for(;o++<r;){let e=0;e=++c<s?t:0,c===i&&(c=0),l.push({x:o,y:Math.round(e)})}return l}}},square:function(){return{title:"方波",tag:"square",image:"/icon2/pulse1_4x.png",params:[{key:"alpha",name:"幅值",icon:"/icon2/setting.png",latex:"A",type:"range::integer",unit:"V",latex_unit:"V",value:[0,200],default_value:80,current:0,preview:!0},{key:"direction",name:"正负",icon:"/icon2/setting.png",latex:"",type:"option::boolean",value:[{label:"正",value:!0},{label:"负",value:!1}],default_value:!0,current:!0,preview:!1},{key:"count",name:"个数",icon:"/icon2/setting.png",latex:"n",type:"range::integer",unit:"个",latex_unit:void 0,value:[0,500],default_value:10,current:0,preview:!0},{key:"alternate",name:"是否交错",icon:"/icon2/setting.png",latex:"",type:"option::boolean",value:[{label:"是",value:!0},{label:"否",value:!1}],default_value:!0,current:!0,preview:!1},{key:"period",name:"周期",icon:"/icon2/setting.png",latex:"T",type:"range::integer",unit:"μs",latex_unit:"\\mu s",value:[1e3,2e6],default_value:2e4,current:1e3,preview:!0},{key:"duty_ratio",name:"占空比",icon:"/icon2/setting.png",latex:"Duty",type:"range::integer",unit:"%",latex_unit:void 0,value:[0,50],default_value:40,current:0,preview:!0}],calculation:{latex:"Volt=A(t)",gen_func:function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;e.params[0].current=t,e.params[1].current=a,e.params[2].current=n,e.params[3].current=i,e.params[4].current=l,e.params[5].current=r;let s=Math.round(l/1e3),o=[],c=n*s,u=s*r/100,d=0,h=0,v=0;for(;d++<c;){let e=0;++h<u?(e=a?t:-t,i&&(e*=v%2==0?1:-1)):e=0,h===s&&(h=0,v++),o.push({x:d,y:Math.round(e)})}return o}}}}};var en=c.forwardRef(function(e,t){let{onAddWaveOpen:a,onPointsUpdate:i,onSendClick:l}=e,[r,s]=(0,c.useState)([]),[o,u]=(0,c.useState)([]),[d,h]=(0,c.useState)(0),[v,_]=(0,c.useReducer)(e=>e+1,1),[g,p]=(0,c.useState)({}),[x,m]=(0,c.useState)(!1),[f,b]=(0,c.useState)(!1),[j,C]=(0,c.useState)(!1),[w,k]=(0,c.useState)(""),P=e=>{let t=ea[e];if(t){let e=t();r.push(e),s(r),o.push([]),u(o);let a=(e.params||[]).map(e=>e.default_value),n=e.calculation.gen_func(e,...a);M(r.length-1,n),_(),D(),console.log({waveConfigs:r,wavePoints:o})}},T=e=>{r.splice(e,1),o.splice(e,1),s(r),u(o),h(0===e?e:e-1),_(),D()},N=e=>{p(e),m(!0),console.log({index:e,currentConfig:r[e]})},S=e=>{m(!1),console.log({waveConfigs:r}),console.log({index:e,currentConfig:r[e]})},X=e=>{let t=r[e]||{};if(t){for(let e of t.params)e.current=e.default_value;s(r);let a=(t.params||[]).map(e=>e.default_value),n=t.calculation.gen_func(t,...a);M(e,n),_(),console.log("reset",r)}};(0,c.useEffect)(()=>{t.addWave=P},[]);let D=()=>{let e=[],t=1;for(let a of o)e=e.concat(a.map((e,a)=>({x:a+t,y:e.y}))),t+=a.length;i&&i(e)},M=(e,t)=>{o[e]=t,u(o),D()},R=()=>{let e=r.map(e=>{let t=e.tag,a=e.params.length,n=e.params.map(e=>"boolean"==typeof e.current?!0===e.current?1:0:e.current);return{type:t,length:a,params:n}});et(e).then(e=>{201===e.status?(b(!0),e.text().then(e=>{let t=(parseInt(e)||0)/1e3;setTimeout(()=>{b(!1)},t)})):e.text().then(e=>{Z(e)})}).catch(e=>{console.error(e),Z(e)})},A=()=>{b(!1)},Z=e=>{k(e),C(!0)};return(0,n.jsxs)("div",{ref:t,children:[x?(0,n.jsx)("div",{children:(0,n.jsx)(I,{onPointsUpdate:e=>M(g,e),onPaneRemove:e=>T(g),config:r[g],closeEditPanel:e=>S(g),resetPanel:e=>X(g),onValuesChange:(e,t)=>{let a=r[g]||{};a.params=a.params.map((a,n)=>(e==n&&(a.current=t),a)),r[g]=a,s(r),console.log({waveConfigs:r,tag:"!!!"})}})}):(0,n.jsxs)("div",{children:[r.map((e,t)=>(0,n.jsx)(B,{waveConfig:e,openEditPanel:e=>N(t),deleteEditPanel:e=>T(t),style:t==r.length-1?{borderBottom:"1px var(--primary-color) solid"}:{}})),(0,n.jsxs)(y.Z,{size:"large",onClick:a,fullWidth:!0,children:[(0,n.jsx)(L.Z,{}),"添加波形"]})]}),(0,n.jsx)("div",{style:{height:220,width:"100%"}}),x?(0,n.jsx)("div",{}):(0,n.jsxs)("div",{className:F().bottom_container,children:[f?(0,n.jsxs)(y.Z,{size:"large",variant:"contained",onClick:A,fullWidth:!0,className:F().stop_button,children:["停止",(0,n.jsx)(G.Z,{})]}):(0,n.jsxs)(y.Z,{size:"large",variant:"contained",onClick:R,fullWidth:!0,className:F().play_button,children:["启动",(0,n.jsx)(H.Z,{})]}),(0,n.jsx)(y.Z,{size:"large",variant:"text",onClick:e.closeEditPanel,fullWidth:!0,className:F().save_button,color:"error",children:"收藏记录"})]}),(0,n.jsxs)(Q.Z,{open:j,onClose:()=>C(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,n.jsx)(ee.Z,{id:"alert-dialog-title",children:"提示"}),(0,n.jsx)(K.Z,{children:(0,n.jsx)($.Z,{id:"alert-dialog-description",children:w})}),(0,n.jsx)(J.Z,{children:(0,n.jsx)(y.Z,{onClick:()=>C(!1),autoFocus:!0,children:"好的"})})]})]})}),ei=a(9008),el=a.n(ei),er=a(7282),es=a.n(er),eo=a(5469),ec=a.n(eo);let eu=e=>{let t=!!e.selected;return(0,n.jsx)("div",{children:t?(0,n.jsx)("div",{className:ec().icon,children:(0,n.jsx)("img",{src:e.icon_active})}):(0,n.jsx)("div",{className:ec().icon,onClick:e.onClick,children:(0,n.jsx)("img",{src:e.icon_normal})})})};var ed=e=>{let[t,a]=(0,c.useState)(1),i=t=>{e.onSelected&&e.onSelected(t)};return(0,n.jsx)("footer",{className:ec().toolbar,...e,style:e["large-space"]?{marginTop:64,marginBottom:48}:{},children:(0,n.jsxs)("div",{className:ec().tools,children:[(0,n.jsx)(eu,{selected:1===t,onClick:e=>{a(1),i("device_list")},icon_active:"/icon2/note.png",icon_normal:"/icon2/note.png"}),(0,n.jsx)(eu,{selected:2===t,onClick:e=>{a(2),i("record_list")},icon_active:"/icon2/device.png",icon_normal:"/icon2/device.png"}),(0,n.jsx)(eu,{selected:3===t,onClick:e=>{a(3),i("dashboard")},icon_active:"/icon2/control.png",icon_normal:"/icon2/device.png"}),(0,n.jsx)(eu,{selected:4===t,onClick:e=>{a(4),i("setting")},icon_active:"/icon2/setting.png",icon_normal:"/icon2/setting.png"})]})})};let eh=[{tag:"square",name:"方波"}];function ev(e){let[t,a]=(0,c.useState)(!1),[i,s]=(0,c.useState)([]),o=(0,c.useRef)(null),[u,d]=(0,c.useState)("测试实验123"),[h,_]=(0,c.useState)(!1),g=(0,c.useRef)(null),p=e=>{o&&(o.addWave(e),a(!1))};return(0,n.jsxs)("div",{className:"jsx-37aa0a29e7071286",children:[(0,n.jsx)(el(),{children:(0,n.jsx)("title",{className:"jsx-37aa0a29e7071286",children:"控制面板 | 手持电转仪"})}),(0,n.jsx)(r.Z,{title:"电转仪-01 | 控制面板",children:(0,n.jsxs)("div",{className:"jsx-37aa0a29e7071286 "+(es().title||""),children:["实验名称：",h?(0,n.jsx)("div",{className:"jsx-37aa0a29e7071286 "+(es().edit_expname_field||""),children:(0,n.jsx)("input",{onChange:e=>d(e.target.value+""),value:u,className:"jsx-37aa0a29e7071286"})}):u.length>10?u.substring(0,9)+"...":u,(0,n.jsx)("div",{onClick:()=>{var e;_(!h),null==g||null===(e=g.current)||void 0===e||e.focus()},className:"jsx-37aa0a29e7071286 "+(es().edit_expname_text||""),children:(0,n.jsx)("img",{src:"/icon2/write.png",className:"jsx-37aa0a29e7071286"})})]})}),(0,n.jsxs)("main",{className:"jsx-37aa0a29e7071286",children:[(0,n.jsx)("div",{className:"jsx-37aa0a29e7071286 "+(es().sticky_top||""),children:(0,n.jsx)("div",{className:"jsx-37aa0a29e7071286 "+(es().wave_monitor||""),children:(0,n.jsx)(b,{width:"100%",height:"180px",points:i})})}),(0,n.jsx)("div",{className:"jsx-37aa0a29e7071286 "+(es().panel||""),children:(0,n.jsx)(en,{ref:o,onAddWaveOpen:()=>{a(!0)},onPointsUpdate:e=>s(e),onSendClick:null})}),(0,n.jsx)(v,{showDrawerBar:!0,visible:t,onOpen:()=>{a(!0)},onClose:()=>{a(!1)},children:(0,n.jsx)("div",{style:{display:"grid",gap:12,marginBottom:24},className:"jsx-37aa0a29e7071286",children:eh.map((e,t)=>(0,n.jsx)("div",{onClick:()=>p(e.tag),style:{margin:"6px auto",padding:"8px 24px",border:"1px #ddd solid",borderRadius:6,gridColumn:t%2+1,gridRow:t/2+1,color:"#555",fontSize:"14px"},className:"jsx-37aa0a29e7071286",children:e.name},t))})})]}),(0,n.jsx)(ed,{}),(0,n.jsx)(l(),{id:"37aa0a29e7071286",children:"main.jsx-37aa0a29e7071286{}"})]})}},3892:function(e){e.exports={appbar:"Appbar_appbar__Djdgg",statusbar:"Appbar_statusbar__TYzED",device_type_name:"Appbar_device_type_name__puiUj",icon_list:"Appbar_icon_list__Xuxbs",ble_status:"Appbar_ble_status__SX8m6",titlebar:"Appbar_titlebar__AUOzV",left:"Appbar_left__DH4gx",right:"Appbar_right__wqxMv",menu:"Appbar_menu__Rwczv"}},5399:function(e){e.exports={container:"RangeInput_container__UaUsT",label:"RangeInput_label__jqQEr",slider:"RangeInput_slider__GtV11"}},2557:function(e){e.exports={container:"Selector_container__Ye4VX",label:"Selector_label__eOk7N",selector:"Selector_selector__1MNUv"}},1517:function(e){e.exports={container:"BottomDrawer_container___F26V",drawer_bar:"BottomDrawer_drawer_bar__LGqlV",bar:"BottomDrawer_bar__A8_H9"}},2795:function(e){e.exports={container:"ConfigItem_container__60YLv",topleft_title:"ConfigItem_topleft_title__KRwhk",left:"ConfigItem_left__cNIfT",right:"ConfigItem_right__KTSxo",end:"ConfigItem_end__i8_Pt",card:"ConfigItem_card__MQdcz",card_header:"ConfigItem_card_header__IGygY",card_icon:"ConfigItem_card_icon__3_ADC",card_title:"ConfigItem_card_title__Hxj0W",card_content:"ConfigItem_card_content__WAwC3",edit_icon:"ConfigItem_edit_icon__KJbH1",delete_icon:"ConfigItem_delete_icon__E68eP"}},3477:function(e){e.exports={config_panel:"ConfigPane_config_panel__oo3YW",bottom_container:"ConfigPane_bottom_container__TwXsu",button:"ConfigPane_button__f3OQl",topleft_title:"ConfigPane_topleft_title__JSSF_"}},3398:function(e){e.exports={device_icon:"CoveredWaveIcon_device_icon__feNDH"}},1329:function(e){e.exports={bottom_container:"WaveTabs_bottom_container__EUY7y",save_button:"WaveTabs_save_button__r4e_X",play_button:"WaveTabs_play_button__WLXcA",stop_button:"WaveTabs_stop_button__x_IDw"}},7282:function(e){e.exports={sticky_top:"DeviceDashboard_sticky_top__b_5hq",device_title:"DeviceDashboard_device_title__mhZXi",title:"DeviceDashboard_title___oI64",edit_expname_text:"DeviceDashboard_edit_expname_text__t5PZZ",edit_expname_field:"DeviceDashboard_edit_expname_field__xFlY3",wave_monitor:"DeviceDashboard_wave_monitor__YTSEF",toolbar_top:"DeviceDashboard_toolbar_top__i6VO2",toolbar_bottom:"DeviceDashboard_toolbar_bottom__V2wwM",wave_result:"DeviceDashboard_wave_result__Fe0rq",panel:"DeviceDashboard_panel__UlrMa"}},5469:function(e){e.exports={toolbar:"Toolbar_toolbar__sVihn",tools:"Toolbar_tools__82ALZ",icon:"Toolbar_icon__QC8Eu"}}},function(e){e.O(0,[885,315,144,122,789,774,888,179],function(){return e(e.s=4935)}),_N_E=e.O()}]);